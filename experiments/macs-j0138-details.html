<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
  <title>MACS J0138 — NFW Experiment (Details) | TinanaLabs</title>
  <link rel="stylesheet" href="/assets/main.css">
  <!-- KaTeX for math -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css">
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/contrib/auto-render.min.js"
    onload="renderMathInElement(document.body,{delimiters:[{left:'$$',right:'$$',display:true},{left:'\\(',right:'\\)',display:false}]});"></script>
  <style>
    .hero{border-radius:16px;overflow:hidden;margin:0 0 1.25rem 0;box-shadow:0 10px 24px rgba(0,0,0,.25)}
    .hero img{width:100%;display:block}
    .kicker{text-transform:uppercase;letter-spacing:.12em;opacity:.8;font-size:.8rem}
    .meta{opacity:.75;font-size:.95rem;margin-top:.25rem}
    .pill{display:inline-block;padding:.25rem .6rem;border:1px solid rgba(255,255,255,.15);border-radius:999px;font-size:.8rem;opacity:.9;margin-right:.5rem;margin-bottom:.5rem}
    .grid{display:grid;gap:1rem}
    @media(min-width:900px){.grid-cols-2{grid-template-columns:1fr 1fr}}
    table{width:100%;border-collapse:collapse}
    th,td{border-bottom:1px solid rgba(255,255,255,.1);padding:.5rem .4rem;vertical-align:top}
    code{background:rgba(255,255,255,.06);padding:.12rem .35rem;border-radius:6px}
    pre{background:rgba(255,255,255,.06);padding:.85rem;border-radius:10px;overflow:auto}
    .callout{border-left:3px solid rgba(255,255,255,.25);padding-left:.9rem;margin:.75rem 0}
  </style>
</head>
<body>
  <header class="site-header">
    <div class="container">
      <a href="/" class="brand">TinanaLabs</a>
      <nav class="nav">
        <a href="/index.html">Home</a>
        <a href="/experiments.html">Experiments</a>
        <a href="/processes.html">Processes</a>
      </nav>
    </div>
  </header>

  <main class="container" style="padding-top:2rem">
    <article class="card">
      <div class="kicker">Experiment Details</div>
      <h1 style="margin:.25rem 0 0">MACS J0138 — NFW Fit & θ<sub>E</sub> Cross-Check</h1>
      <div class="meta">System: MACS J0138.0-2155 · Lens redshift \(z_L=0.336\) · Strong-lensing cluster</div>

      <div class="hero" style="margin-top:1rem">
        <img src="/assets/img/macs-j0138.jpg" alt="HST cutout of MACS J0138 (cluster lens)">
      </div>

      <div style="margin-bottom:1rem">
        <span class="pill">HST / MAST</span>
        <span class="pill">Strong Lensing</span>
        <span class="pill">NFW Profile</span>
        <span class="pill">Reproducible Pipeline</span>
      </div>

      <section>
        <h2>Purpose</h2>
        <p>Fit an NFW halo to MACS J0138 using published constraints (Einstein radius \(\\theta_E\) and/or convergence \(\\kappa(R)\)), then
        check internal consistency and log residuals. The objective is to determine whether a standard NFW halo within GR
        explains the observed bending strength.</p>
      </section>

      <section>
        <h2>Key Formulas</h2>
        <p><strong>NFW density</strong></p>
        <div>$$
          \\rho(r)=\\frac{\\rho_s}{(r/r_s)\\left(1+r/r_s\\right)^2}
        $$</div>

        <p><strong>3D mass</strong></p>
        <div>$$
          M(<r)=4\\pi\\rho_s r_s^3\\left[\\ln\\!\\left(1+\\frac{r}{r_s}\\right)-\\frac{\\frac{r}{r_s}}{1+\\frac{r}{r_s}}\\right]
        $$</div>

        <p><strong>Critical surface density & Einstein condition</strong></p>
        <div>$$
          \\Sigma_{\\rm crit}=\\frac{c^2}{4\\pi G}\\frac{D_S}{D_L D_{LS}},\\qquad
          \\bar{\\kappa}(\\theta_E)=1
        $$</div>
      </section>

      <section>
        <h2>Datasets</h2>
        <ul>
          <li><strong>HST cutouts (context):</strong> downloaded from MAST for MACS J0138 (WFC3/IR F160W and others). Example path:
            <code>~/Downloads/MAST_MACS_J0138/mastDownload/output/*cutout.fits</code></li>
          <li><strong>Literature constraints:</strong> \(z_L=0.336\), \(z_S\) from MACS J0138 multiply-imaged SN host; published \(\\theta_E\) / \(\\kappa(R)\) values used for fitting and cross-check.</li>
        </ul>
        <p class="meta">We store pointers to raw sources in <code>data/</code> with a <code>README.sources.md</code> noting paper/Zenodo references.</p>
      </section>

      <section>
        <h2>Code Modules & Scripts</h2>

        <table>
          <thead><tr><th>File</th><th>Role</th><th>Notable Args / I/O</th></tr></thead>
          <tbody>
            <tr>
              <td><code>download_macs_j0138_mast.py</code></td>
              <td>Query MAST and fetch HST cutouts for MACS J0138.</td>
              <td><em>Output:</em> FITS cutouts in <code>~/Downloads/MAST_MACS_J0138/mastDownload/output/</code></td>
            </tr>
            <tr>
              <td><code>nfw_lensing_starter.py</code></td>
              <td>Compute distances, solve \(\\theta_E\) from an external \(M(<R_*)\) or fit NFW \(\\rho_s, r_s\) grid.</td>
              <td><em>Args (sample):</em> <code>--zS</code>, <code>--solve-theta-from-mass</code>, <code>--Rstar</code>, <code>--rs-min</code>, <code>--rs-max</code>, <code>--n</code>, <code>--concentration-sample</code>. <br><em>Output:</em> summary printout + figures in <code>output/</code>.</td>
            </tr>
            <tr>
              <td><code>make_nfw_from_thetaE.py</code></td>
              <td>Utility to invert an observed \(\\theta_E\) into a consistent \(\\{\\rho_s,r_s\\}\) locus / prior for the main fit.</td>
              <td><em>Input:</em> observed \(\\theta_E\), \(z_L,z_S\). <em>Output:</em> JSON prior or grid CSV in <code>output/</code>.</td>
            </tr>
            <tr>
              <td><code>analyze_ratio.py</code></td>
              <td>Downstream diagnostic: computes global ratio statistics and residuals across panels; logs CI and rank stats (used across experiments).</td>
              <td><em>Output:</em> <code>output/lenses_results.csv</code>, <code>output/lenses_summary.txt</code></td>
            </tr>
            <tr>
              <td><code>ratio_residuals.py</code></td>
              <td>Plots/prints model − data residuals, focusing on signed proxy residual definition used across panels.</td>
              <td><em>Args:</em> dataset selectors; <em>Output:</em> PNGs + console stats.</td>
            </tr>
            <tr>
              <td><code>scripts/plot_BH_GW.py</code></td>
              <td>Shared plotting utilities (used for multi-panel style consistency).</td>
              <td><em>Input:</em> CSVs; <em>Output:</em> figures in <code>output/</code>.</td>
            </tr>
          </tbody>
        </table>

        <p class="callout">While some utilities are shared with BH/GW panels, this page lists them for completeness because they were used to keep plotting and residual definitions consistent.</p>
      </section>

      <section>
        <h2>Pipeline (Repro Steps)</h2>

<pre><code># 1) Download imaging cutouts (context)
python download_macs_j0138_mast.py

# 2) Solve / fit NFW using a reference mass at R* or a literature θ_E
# Example from our run log:
# [solve-theta] Using external M(&lt;R*&gt;): 2.89e+13 solMass at R*=60 kpc
# [solve-theta] -&gt; θ_E = 13.0326 arcsec, R_E = 64.6715 kpc
# Distances: D_L=1023.55 Mpc, D_S=1774.28 Mpc

/ home/USER/ratio_test/mastenv/bin/python3 nfw_lensing_starter.py \
  --zS 1.949 --solve-theta-from-mass 2.89e13 --Rstar 60 \
  --rs-min 150 --rs-max 800 --n 400 --concentration-sample 50

# 3) (Optional) Convert a literature θ_E into an NFW prior grid
python make_nfw_from_thetaE.py --thetaE-arcsec 13.03 --zL 0.336 --zS 1.949 -o output/nfw_prior.json

# 4) Residual analysis & report artifacts
python ratio_residuals.py --lenses-only
python analyze_ratio.py
</code></pre>

        <p class="meta">Artifacts land in <code>output/</code> and <code>figures/</code>; source pointers in <code>data/</code>.</p>
      </section>

      <section>
        <h2>Results Snapshot</h2>
        <ul>
          <li><strong>Solved Einstein radius:</strong> \(\\theta_E \\approx 13.03\\) arcsec (given \(M(<60\\,\\mathrm{kpc})=2.89\\times10^{13}M_\\odot\))</li>
          <li><strong>Distances (flat ΛCDM):</strong> \(D_L \\approx 1023.6\\,\\mathrm{Mpc},\\ D_S \\approx 1774.3\\,\\mathrm{Mpc}\)</li>
          <li><strong>Outputs:</strong> prior JSON / grid CSV; diagnostic plots (κ-profile and θ<sub>E</sub> checks)</li>
        </ul>
        <p class="callout">Final best-fit \(\\{\\rho_s,r_s\\}\) and 1σ intervals are updated after each re-run and posted in <code>nfw_fit.json</code>.</p>
      </section>

      <section>
        <h2>Interpretation (What does this mean?)</h2>
        <p>We test whether a standard dark-matter halo (NFW) under GR can reproduce the observed bending of light by the cluster.</p>
        <ul>
          <li>\(\\theta_E\) acts like the lens’s “ring size.” If the model gets this right, the overall mass scale is sensible.</li>
          <li>\(\\rho_s\) (density scale) and \(r_s\) (scale radius) are the two knobs describing how mass is packed.</li>
          <li>A good match to both \(\\theta_E\) and the detailed \(\\kappa(R)\) profile supports a normal halo explanation; a mismatch quantifies where our assumptions or inputs need revision — a key falsification lever for theory.</li>
        </ul>
      </section>

      <section>
        <h2>Artifacts & File Layout</h2>
        <div class="grid grid-cols-2">
          <div>
            <h3>Inputs</h3>
            <ul>
              <li><code>data/</code> — references to literature values & cutout notes</li>
              <li><code>~/Downloads/MAST_MACS_J0138/mastDownload/output/</code> — HST FITS cutouts</li>
            </ul>
          </div>
          <div>
            <h3>Outputs</h3>
            <ul>
              <li><code>output/</code> — tables (e.g., <code>nfw_fit.json</code>), summaries</li>
              <li><code>figures/</code> — diagnostic plots</li>
            </ul>
          </div>
        </div>
      </section>

      <section>
        <h2>Re-Run Checklist</h2>
        <ol>
          <li>Verify \(z_L, z_S\) and the latest \(\\theta_E\) / \(\\kappa(R)\) constraints in <code>data/</code>.</li>
          <li>Re-generate NFW grid/prior if constraints changed.</li>
          <li>Run <code>nfw_lensing_starter.py</code> with updated args; inspect <code>figures/</code>.</li>
          <li>Update <code>nfw_fit.json</code> and regenerate the Results section.</li>
        </ol>
      </section>

      <footer style="opacity:.7;margin-top:1rem">
        Maintainer: Frank Tinana (with Lyra) · Last updated: 2025-09-02
      </footer>
    </article>

    <p style="margin:1.5rem 0">
      <a class="pill" href="/experiments/macs-j0138.html">← Summary Page</a>
      <a class="pill" href="/experiments.html">All Experiments</a>
    </p>
  </main>

  <footer class="site-footer"><div class="container">© TinanaLabs</div></footer>
</body>
</html>
